<!DOCTYPE html>
<html>
  <head>
  
    <style>
    
      body
      {
        margin: 0;
        padding: 3px 8px;
      }
      
      form
      {
        margin: 0;
        padding: 0;
        display: inline;
      }
      
      #search_field
      {
        width: 200px;
      }
      
      /**
       * Thanks to Chris Morrell <http://cmorrell.com/> for the toolbar style code
       */
      
      a, button {
        color: #282828;
        font-weight: bold;
        text-shadow: 0px 1px 0px rgba(255, 255, 255, 0.4);
        text-decoration: none;
        padding: 1px 7px 2px;
        display: inline-block;
        border-radius: 8px;
        cursor: default;
        border: none;
        background: none;
      }
      
      a:hover, button:hover {
        color: #fff;
        text-shadow: 0px 1px 0px rgba(0, 0, 0, 0.4);
        background: rgba(0, 0, 0, 0.21);
      }
      
      a:active, button:active, a.toggled, button.toggled {
        color: #fff;
        text-shadow: 0px 1px 0px rgba(0, 0, 0, 0.4);
        -webkit-box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.5), 0 1px 1px rgba(255, 255, 255, 0.8);
      }
      
      a.toggled, button.toggled {
        background: rgba(0, 0, 0, 0.35);
      }
      
      a:active, button:active {
        background: rgba(0, 0, 0, 0.49);
      }
      
    </style>
    
    <script type="text/javascript" src="jquery/js/jquery-1.4.2.min.js"></script>
    <script type="text/javascript">
    
      SearchmarksUI = {
      
        searchEngine : null,
    
        search : function(query)
        {
          var url;
          var query = escape(query);
          
          switch (this.searchEngine)
          {
            case 'wikipedia':
              url = 'http://www.wikipedia.org/search-redirect.php?search='+query+'&language=en&go=Go';
              break;
              
            case 'amazon':
              url = 'http://www.amazon.com/s/?field-keywords='+query;
              break;
              
            case 'lastfm':
              url = 'http://www.last.fm/search?q='+query;
              break;
              
            case 'imdb':
              url = 'http://www.imdb.com/find?s=all&q='+query;
              break;
              
            default:
              throw "Unknown search engine";
          }
          
          safari.application.activeBrowserWindow.activeTab.url = url;
        },
        
        setSearchEngine : function(searchEngine, setFocus)
        {
          // un-toggle all buttons
          $('.engine_button').each(
            function(index)
            {
              this.className = 'engine_button';
            }
          );
          
          // toggle the specific button we need
          $('#engine_button_'+searchEngine).get(0).className = 'engine_button toggled';
          
          this.searchEngine = searchEngine;
          
          if (setFocus == undefined || setFocus == true)
          {
            $('#search_field').select();
            $('#search_field').focus();
          }
        }
        
      }
      
      $(document).ready(
        function()
        {
          SearchmarksUI.setSearchEngine('wikipedia', false);
        }
      );
      
    </script>
    
  </head>
  
  <body>
    <a href="javascript:return false;">Searchmarks</a>
    <form onSubmit="SearchmarksUI.search(document.getElementById('search_field').value); return false;" >
      <input id="search_field" type="search" autosave="org.horizon-nigh.searchmarks.ext.safari" results="10" />
      <input id="go_button" type="submit" value="&#8594;" />
    </form>
    
    <a class="engine_button" id="engine_button_wikipedia" href="javascript:SearchmarksUI.setSearchEngine('wikipedia'); return false;">Wikipedia</a>
    <a class="engine_button" id="engine_button_amazon" href="javascript:SearchmarksUI.setSearchEngine('amazon'); return false;">Amazon</a>
    <a class="engine_button" id="engine_button_lastfm" href="javascript:SearchmarksUI.setSearchEngine('lastfm'); return false;">Last.fm</a>
    <a class="engine_button" id="engine_button_imdb" href="javascript:SearchmarksUI.setSearchEngine('imdb'); return false;">IMDb</a>
  </body>
  
</html>
